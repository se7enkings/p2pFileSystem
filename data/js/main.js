// Generated by CoffeeScript 1.9.1
var FileListRequestProtocol, addFileToRow, fileList, onClickRow, paths, updateTable, url, webSocket;

FileListRequestProtocol = "fsrp";

url = "ws://" + window.location.host + "/ws";

webSocket = new WebSocket(url);

fileList = null;

paths = new Array();

webSocket.onopen = function() {
  webSocket.send(FileListRequestProtocol);
};

webSocket.onmessage = function(event) {
  var message, messageContent, messageType;
  message = JSON.parse(event.data);
  for (messageType in message) {
    messageContent = message[messageType];
    switch (messageType) {
      case FileListRequestProtocol:
        fileList = message[FileListRequestProtocol];
        updateTable();
    }
  }
};

updateTable = function() {
  var dir, file, i, j, k, len, list, name, ref, ref1, row, table;
  list = fileList;
  for (j = 0, len = paths.length; j < len; j++) {
    dir = paths[j];
    if (list["Children"][dir] != null) {
      list = list["Children"][dir];
    } else {
      list = fileList;
      paths = new Array();
      break;
    }
  }
  table = document.getElementById("fileList");
  for (i = k = 1, ref = table.rows.length; 1 <= ref ? k < ref : k > ref; i = 1 <= ref ? ++k : --k) {
    table.deleteRow(1);
  }
  i = 1;
  ref1 = list["Children"];
  for (name in ref1) {
    file = ref1[name];
    row = table.insertRow(i);
    i++;
    addFileToRow(row, file);
  }
  $("tbody > tr").off().click(onClickRow);
};

addFileToRow = function(row, file) {
  var atLocal, isDir, name, size;
  name = row.insertCell(0);
  isDir = row.insertCell(1);
  atLocal = row.insertCell(2);
  size = row.insertCell(3);
  name.innerHTML = file.Name;
  isDir.innerHTML = file.IsDir;
  atLocal.innerHTML = file.AtLocal;
  size.innerHTML = file.Size;
};

onClickRow = function() {
  var isDir, name;
  name = this.getElementsByTagName("td")[0].innerHTML;
  isDir = this.getElementsByTagName("td")[1].innerHTML;
  if (name === ".." && paths.length > 0) {
    paths.pop();
  } else if (isDir === "true") {
    paths.push(name);
  }
  updateTable();
};
